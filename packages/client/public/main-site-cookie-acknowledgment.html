
<html lang="en">
<head>
    <title>Request Storage Access</title>
    <link rel="stylesheet" href="content/basic.css">
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', async (event) => {
            const data = JSON.parse(document.cookie
                .split("; ")
                .find((row) => row.startsWith('ee.hyperflux.AuthState.authUser='))
                ?.split("=")[1])
            if (data) {
                const token = data.accessToken
                const userId = data.identityProvider.userId
                const req = new Request(`https://api-local.etherealengine.org/user/${userId}`, {
                    headers: new Headers({
                        Authorization: `Bearer ${token}`
                    })
                })
                const response = await fetch(req)
                const body = await response.json()
                if (body) {
                    console.log('body', body)
                    document.getElementById('mainText').textContent = document.getElementById('mainText').textContent.replace('your login', `your login as ${body.name}`)
                }
            }
            document.getElementById('confirmButton').addEventListener("click", event => {
                document.cookie = 'visited=true; SameSite=None; Secure'
                // Just go back to the outside iframe we came from.
                window.close()
            });
        });
    </script>
</head>
<body>
<h2 id="mainText">This domain runs on Ethereal Engine. To automatically use your login across all Ethereal Engine-powered domains, please click the button.</h2>
<button id="confirmButton">Click to confirm</button>
</body>
</html>